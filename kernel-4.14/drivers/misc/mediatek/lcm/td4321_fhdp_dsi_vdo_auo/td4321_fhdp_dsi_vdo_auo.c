#define LOG_TAG "LCM"

#ifndef BUILD_LK
#include <linux/string.h>
#include <linux/kernel.h>
#endif

#include "lcm_drv.h"


#ifdef BUILD_LK
#include <platform/upmu_common.h>
#include <platform/mt_gpio.h>
#include <platform/mt_i2c.h>
#include <platform/mt_pmic.h>
#include <string.h>
#elif defined(BUILD_UBOOT)
#include <asm/arch/mt_gpio.h>
#else
/*#include <mach/mt_pm_ldo.h>*/
#ifdef CONFIG_MTK_LEGACY
#include <mach/mt_gpio.h>
#endif
#endif

#ifdef BUILD_LK
#define LCM_LOGI(fmt, args...)  printk(KERN_INFO  " LCM file=%s: %s: line=%d: "fmt"\n", __FILE__,__func__,  __LINE__,##args)
#define LCM_LOGD(fmt, args...)  printk(KERN_DEBUG " LCM file=%s: %s: line=%d: "fmt"\n", __FILE__,__func__,  __LINE__,##args)
#else
#define LCM_LOGI(fmt, args...)  printk(KERN_INFO " LCM :"fmt"\n", ##args)
#define LCM_LOGD(fmt, args...)  printk(KERN_DEBUG " LCM :"fmt"\n", ##args)
#endif

#define I2C_I2C_LCD_BIAS_CHANNEL 0
static struct LCM_UTIL_FUNCS lcm_util;

#define SET_RESET_PIN(v)			(lcm_util.set_reset_pin((v)))
#define MDELAY(n)					(lcm_util.mdelay(n))

/* --------------------------------------------------------------------------- */
/* Local Functions */
/* --------------------------------------------------------------------------- */
#define dsi_set_cmdq_V2(cmd, count, ppara, force_update) \
	lcm_util.dsi_set_cmdq_V2(cmd, count, ppara, force_update)
#define dsi_set_cmdq(pdata, queue_size, force_update) \
	lcm_util.dsi_set_cmdq(pdata, queue_size, force_update)
#define wrtie_cmd(cmd) \
	lcm_util.dsi_write_cmd(cmd)
#define write_regs(addr, pdata, byte_nums) \
	lcm_util.dsi_write_regs(addr, pdata, byte_nums)
#define read_reg(cmd) \
	lcm_util.dsi_dcs_read_lcm_reg(cmd)
#define read_reg_v2(cmd, buffer, buffer_size) \
	lcm_util.dsi_dcs_read_lcm_reg_v2(cmd, buffer, buffer_size)

static const unsigned char LCD_MODULE_ID = 0x01;
/* --------------------------------------------------------------------------- */
/* Local Constants */
/* --------------------------------------------------------------------------- */
#define LCM_DSI_CMD_MODE	0
#define FRAME_WIDTH  										1080
#define FRAME_HEIGHT 										2340
//prize-penggy modify LCD size-20190328-start
#define LCM_PHYSICAL_WIDTH                  				(67070)
#define LCM_PHYSICAL_HEIGHT                  				(145310)
//prize-penggy modify LCD size-20190328-end

#define REGFLAG_DELAY             							 0xFFFA
#define REGFLAG_UDELAY             							 0xFFFB
#define REGFLAG_PORT_SWAP									 0xFFFC
#define REGFLAG_END_OF_TABLE      							 0xFFFD   // END OF REGISTERS MARKER

#ifndef TRUE
#define TRUE 1
#endif

#ifndef FALSE
#define FALSE 0
#endif

/* --------------------------------------------------------------------------- */
/* Local Variables */
/* --------------------------------------------------------------------------- */

struct LCM_setting_table {
	unsigned int cmd;
	unsigned char count;
	unsigned char para_list[190];
};
/*prize penggy add-for LCD ESD-20190228-start*/

static struct LCM_setting_table lcm_initialization_setting[] = {

	{0xB0,1,{0x00}},
	{0xB6,5,{0x30 ,0x6b ,0x00 ,0x82 ,0xe3}},
	{0xB7,4,{0x51 ,0x00 ,0x00 ,0x00}},
	{0xB8,7,{0x57 ,0x3d ,0x19 ,0xbe ,0x1e ,0x0a ,0x0a}},
	{0xB9,7,{0x6f ,0x3d ,0x28 ,0xbe ,0x3c ,0x14 ,0x0a}},
	{0xBA,7,{0xb5 ,0x33 ,0x41 ,0xbe ,0x64 ,0x23 ,0x0a}},
	{0xBB,11,{0x44 ,0x26 ,0xc3 ,0x1f ,0x19 ,0x06 ,0x03 ,0xc0 ,0x00 ,0x00 ,0x10}},
	{0xBC,11,{0x32 ,0x4c ,0xc3 ,0x52 ,0x32 ,0x1f ,0x03 ,0xf2 ,0x00 ,0x00 ,0x13}},
	{0xBD,11,{0x24 ,0x68 ,0xc3 ,0xaa ,0x3f ,0x32 ,0x03 ,0xff ,0x00 ,0x00 ,0x25}},
	{0xBE,12,{0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xC0,22,{0x00 ,0xcd ,0x01 ,0x2c ,0x0a ,0x09 ,0x24 ,0x00 ,0x0a ,0x00 
			 ,0x00 ,0x08 ,0x60 ,0x70 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00}},
	{0xC1,45,{0x30 ,0x00 ,0x00 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x22 ,0x00 
			 ,0x05 ,0x20 ,0x00 ,0x80 ,0xfa ,0x40 ,0x00 ,0x80 ,0x0f ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x01 ,0x2c ,0x08 ,0x08}},
	{0xC2,141,{0x00 ,0x00 ,0xcc ,0x02 ,0x02 ,0x00 ,0x07 ,0x05 ,0x44 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x40 ,0xc1 
			 ,0x04 ,0x04 ,0x01 ,0x01 ,0x01 ,0x00 ,0x09 ,0x37 ,0x00 ,0x00 
			 ,0x01 ,0x08 ,0x00 ,0x00 ,0x00 ,0x44 ,0x11 ,0x00 ,0x09 ,0x37 
			 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x11 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x11 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00}},
	{0xC3,108,{0x00 ,0x00 ,0xc3 ,0x01 ,0x95 ,0xa9 ,0x6a ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0xcc ,0x01 ,0x93 ,0x99 ,0x5a ,0x04 ,0x02 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0xaa ,0xaa ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x01 ,0x00 ,0x01 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xc0 
			 ,0x00 ,0x01 ,0x00 ,0x01 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xc0 
			 ,0x00 ,0x01 ,0x00 ,0x01 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xc0 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xC4,97,{0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x54 ,0x4c 
			 ,0x51 ,0x4d ,0x4d ,0x61 ,0x5f ,0x5d ,0x0f ,0x11 ,0x44 ,0x4f 
			 ,0x4f ,0xbe ,0xbf ,0x03 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x54 ,0x4c ,0x51 ,0x4d ,0x4d ,0x61 ,0x5f ,0x5d 
			 ,0x0e ,0x10 ,0x44 ,0x4f ,0x4f ,0xbe ,0xbf ,0x02 ,0xff ,0xff 
			 ,0xff ,0xff ,0xff ,0xff ,0x00 ,0xfe ,0xe7 ,0x00 ,0xfe ,0xe7 
			 ,0x00 ,0x02 ,0x18 ,0x00 ,0x02 ,0x18 ,0x00 ,0xe0 ,0x00 ,0x00 
			 ,0xe0 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x04 ,0x04 
			 ,0x00 ,0x00 ,0x04 ,0x04 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x50 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xC5,5,{0x08 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xC6,62,{0x02 ,0x1a ,0x08 ,0xfc ,0xff ,0xff ,0xff ,0x00 ,0x00 ,0x13 
			 ,0x01 ,0xff ,0x00 ,0x01 ,0x0b ,0x3a ,0x3c ,0x36 ,0x00 ,0x00 
			 ,0x00 ,0x01 ,0x05 ,0x09 ,0x28 ,0x28 ,0x01 ,0x0b ,0x3a ,0x3c 
			 ,0x36 ,0x01 ,0x0b ,0x00 ,0x00 ,0x00 ,0x1e ,0x01 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x20 ,0x20 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x22 ,0x22 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x10 ,0x00}},
	{0xC7,76,{0x00 ,0xF6 ,0x01 ,0x55 ,0x01 ,0x8A ,0x01 ,0x93 ,0x01 ,0x9E 
			 ,0x01 ,0x9E ,0x01 ,0xA1 ,0x01 ,0x9A ,0x01 ,0xB5 ,0x01 ,0x84 
			 ,0x01 ,0xD5 ,0x01 ,0x92 ,0x01 ,0xD3 ,0x01 ,0x8A ,0x01 ,0xEE 
			 ,0x01 ,0xE2 ,0x02 ,0x4B ,0x02 ,0x7C ,0x02 ,0xAE ,0x00 ,0xF6 
			 ,0x01 ,0x55 ,0x01 ,0x8A ,0x01 ,0x93 ,0x01 ,0x9E ,0x01 ,0x9E 
			 ,0x01 ,0xA1 ,0x01 ,0x9A ,0x01 ,0xB5 ,0x01 ,0x84 ,0x01 ,0xD5 
			 ,0x01 ,0x92 ,0x01 ,0xD3 ,0x01 ,0x8A ,0x01 ,0xEE ,0x01 ,0xE2 
			 ,0x02 ,0x4B ,0x02 ,0x7C ,0x02 ,0xAE}},
	{0xCB,14,{0xa0 ,0x80 ,0x70 ,0x00 ,0x20 ,0x00 ,0x00 ,0x2d ,0x41 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0xff}},
	{0xCE,33,{0x5d ,0x40 ,0x49 ,0x53 ,0x59 ,0x5e ,0x63 ,0x68 ,0x6e ,0x74 
			 ,0x7e ,0x8a ,0x98 ,0xa8 ,0xbb ,0xd0 ,0xe7 ,0xff ,0x04 ,0x00 
			 ,0x04 ,0x04 ,0x42 ,0x40 ,0x69 ,0x5a ,0x40 ,0x40 ,0x00 ,0x00 
			 ,0x04 ,0xfa ,0x00}},
	{0xCF,6,{0x00 ,0x00 ,0x80 ,0x46 ,0x61 ,0x00}},
	{0xD0,18,{0xdf ,0x0b ,0x83 ,0x66 ,0x09 ,0x90 ,0x00 ,0xcc ,0x0f ,0x05 
			 ,0xd7 ,0x4b ,0x52 ,0xfe ,0x09 ,0x09 ,0xcc ,0x00}},
	{0xD1,34,{0xd7 ,0xd7 ,0x1b ,0xe4 ,0x07 ,0x07 ,0xbb ,0x00 ,0x90 ,0x00 
			 ,0x90 ,0x05 ,0x11 ,0x7b ,0x07 ,0x11 ,0x7b ,0x78 ,0xd3 ,0xda 
			 ,0x06 ,0x96 ,0x1c ,0x93 ,0x22 ,0x22 ,0x22 ,0xb3 ,0xbb ,0x80 
			 ,0x00 ,0x99 ,0x99 ,0x00}},
	{0xD2,2,{0x00 ,0x00}},
	{0xD3,153,{0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0xff 
			 ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 
			 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff 
			 ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff 
			 ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 
			 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff 
			 ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff 
			 ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 
			 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff 
			 ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff 
			 ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 
			 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff 
			 ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff 
			 ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 
			 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff ,0xff ,0xf7 ,0xff 
			 ,0xff ,0xf7 ,0xff}},
	{0xD4,23,{0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00}},
	{0xE5,1,{0x03}},
	{0xD5,4,{0x00 ,0x32 ,0x00 ,0x33}},
	{0xD7,74,{0x21 ,0x10 ,0x52 ,0x52 ,0x00 ,0xcd ,0x00 ,0x0a ,0x00 ,0xb6 
			 ,0x04 ,0xfd ,0x01 ,0x00 ,0x03 ,0x00 ,0x05 ,0x05 ,0x00 ,0x03 
			 ,0x04 ,0x05 ,0x00 ,0x04 ,0x00 ,0x08 ,0x02 ,0x08 ,0x06 ,0x03 
			 ,0x08 ,0x04 ,0x08 ,0x08 ,0x0c ,0x0b ,0x0a ,0x0a ,0x0a ,0x07 
			 ,0x08 ,0x0a ,0x06 ,0x00 ,0x08 ,0x08 ,0x04 ,0x05 ,0x09 ,0x00 
			 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x02 ,0x04 ,0x04 
			 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x04 ,0x06 ,0x06 
			 ,0x05 ,0x05 ,0x05 ,0x00}},
	{0xD8,62,{0x00 ,0x12 ,0x41 ,0x00 ,0x41 ,0x00 ,0x82 ,0x00 ,0xa8 ,0xaa 
			 ,0x00 ,0x50 ,0x55 ,0x08 ,0xa2 ,0x2a ,0x0a ,0x45 ,0x15 ,0x0d 
			 ,0x8a ,0x8a ,0x0a ,0x15 ,0x45 ,0x0d ,0x2a ,0xa0 ,0x0a ,0x55 
			 ,0x50 ,0x0d ,0xaa ,0xa8 ,0x0a ,0x55 ,0x50 ,0x0d ,0x2a ,0xa2 
			 ,0x0a ,0x15 ,0x45 ,0x0d ,0x8a ,0x8a ,0x0a ,0x45 ,0x15 ,0x0d 
			 ,0xa2 ,0x2a ,0x0a ,0x51 ,0x55 ,0x0c ,0xa8 ,0xaa ,0x08 ,0x54 
			 ,0x55 ,0x01}},
	{0xD9,22,{0x42 ,0x97 ,0x26 ,0xed ,0x0f ,0x24 ,0x16 ,0x6c ,0x16 ,0x6c 
			 ,0x00 ,0x30 ,0x00 ,0x14 ,0x00 ,0x14 ,0x00 ,0x0c ,0x00 ,0x00 
			 ,0x01 ,0x00}},
	{0xDD,4,{0x30 ,0x06 ,0x23 ,0x65}},
	{0xDE,10,{0x00 ,0x00 ,0x00 ,0x0f ,0xff ,0x00 ,0x00 ,0x00 ,0x00 ,0x10}},
	{0xE6,10,{0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xE7,182,{0x11 ,0x00 ,0x89 ,0x10 ,0x80 ,0x09 ,0x24 ,0x04 ,0x38 ,0x00 
			 ,0x04 ,0x02 ,0x1c ,0x02 ,0x1c ,0x02 ,0x00 ,0x02 ,0x0e ,0x20 
			 ,0x00 ,0x56 ,0x00 ,0x07 ,0x0c ,0x20 ,0x00 ,0x19 ,0x6d ,0x18 
			 ,0x00 ,0x10 ,0xf0 ,0x03 ,0x0c ,0x20 ,0x00 ,0x06 ,0x0b ,0x0b 
			 ,0x33 ,0x0e ,0x1c ,0x2a ,0x38 ,0x46 ,0x54 ,0x62 ,0x69 ,0x70 
			 ,0x77 ,0x79 ,0x7b ,0x7d ,0x7e ,0x01 ,0x02 ,0x01 ,0x00 ,0x09 
			 ,0x40 ,0x09 ,0xbe ,0x19 ,0xfc ,0x19 ,0xfa ,0x19 ,0xf8 ,0x1a 
			 ,0x38 ,0x1a ,0x78 ,0x1a ,0xb6 ,0x2a ,0xf6 ,0x2b ,0x34 ,0x2b 
			 ,0x74 ,0x3b ,0x74 ,0x6b ,0xf4 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x11 ,0x00 ,0x89 ,0x10 ,0x80 ,0x09 ,0x24 ,0x04 ,0x38 
			 ,0x00 ,0x04 ,0x02 ,0x1c ,0x02 ,0x1c ,0x02 ,0x00 ,0x02 ,0x0e 
			 ,0x20 ,0x00 ,0x56 ,0x00 ,0x07 ,0x0c ,0x20 ,0x00 ,0x19 ,0x6d 
			 ,0x18 ,0x00 ,0x10 ,0xf0 ,0x03 ,0x0c ,0x20 ,0x00 ,0x06 ,0x0b 
			 ,0x0b ,0x33 ,0x0e ,0x1c ,0x2a ,0x38 ,0x46 ,0x54 ,0x62 ,0x69 
			 ,0x70 ,0x77 ,0x79 ,0x7b ,0x7d ,0x7e ,0x01 ,0x02 ,0x01 ,0x00 
			 ,0x09 ,0x40 ,0x09 ,0xbe ,0x19 ,0xfc ,0x19 ,0xfa ,0x19 ,0xf8 
			 ,0x1a ,0x38 ,0x1a ,0x78 ,0x1a ,0xb6 ,0x2a ,0xf6 ,0x2b ,0x34 
			 ,0x2b ,0x74 ,0x3b ,0x74 ,0x6b ,0xf4 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00}},
	{0xE8,4,{0x00 ,0x30 ,0x63 ,0x00}},
	{0xEA,30,{0x01 ,0x0e ,0x03 ,0xc0 ,0x0a ,0xa0 ,0xaa ,0x00 ,0x09 ,0x00 
			 ,0x02 ,0x94 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x04 ,0xc2 ,0x00 ,0x11 ,0x00 ,0xcd ,0x0c ,0xd0 ,0x86 ,0x00}},
	{0xEB,7,{0x02 ,0x40 ,0x0c ,0x00 ,0x01 ,0x00 ,0x01}},
	{0xEC,10,{0x04 ,0x90 ,0x08 ,0x10 ,0x52 ,0x0a ,0xa0 ,0xaa ,0x02 ,0x3a}},
	{0xED,32,{0x01 ,0x01 ,0x02 ,0x02 ,0x08 ,0x08 ,0x09 ,0x09 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x02 ,0x00 ,0x00 ,0x00 ,0x00 ,0x12 ,0x02 ,0x8c 
			 ,0x00 ,0x00 ,0x00 ,0x50 ,0x00 ,0x02 ,0x8c ,0x00 ,0x00 ,0xa0 
			 ,0x10 ,0x00}},
	{0xEE,96,{0xc3 ,0x17 ,0x00 ,0x00 ,0x00 ,0xfd ,0x01 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0xc2 ,0x5f ,0x7f ,0xf0 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0xc0 ,0x03 ,0x7f ,0xfc ,0x00 ,0x90 ,0x09 
			 ,0x09 ,0x09 ,0x49 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x01 ,0x00 ,0x00 ,0x00 ,0x00 ,0x40 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x01 ,0x00 ,0xc0 ,0x1f ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00}},
	{0xEF,83,{0x00 ,0xe0 ,0x4a ,0x08 ,0x60 ,0x00 ,0x00 ,0x00 ,0x00 ,0x32 
			 ,0x32 ,0x32 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x10 ,0x00 ,0x10 ,0x00 ,0x00 
			 ,0x10 ,0x00 ,0x10 ,0x00 ,0x0a ,0x0a ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x43 ,0x00 ,0x03 ,0x40 ,0x00 ,0x00 ,0x05 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 
			 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00 ,0x00
			 ,0x00 ,0x00 ,0x00}},
	{0xF9,5,{0x44 ,0x3f ,0x00 ,0x8d ,0xbf}},
	{0xB0,1,{0x03}},
	{0xB0,1,{0x00}},                               
	{0xD6,1,{0x00}},                                 
	{0x51,1,{0xFF}},                               
	{0x53,1,{0x0C}},                                
	{0x55,1,{0x00}},
	{0x11,1,{0x00}},
	{REGFLAG_DELAY,120,{}},


	{0x29,1,{0x00}},
	{REGFLAG_DELAY, 50, {}},

	{REGFLAG_END_OF_TABLE, 0x00, {}}    
              
};


#if 1
static struct LCM_setting_table lcm_suspend_setting[] = {
	{0x28, 1,{0x00} },
	{REGFLAG_DELAY, 120, {} },
	{0x10, 1,{0x00} },
	{REGFLAG_DELAY, 10, {} },
	{REGFLAG_END_OF_TABLE, 0x00, {}}  
};
#endif
/*prize penggy add-for LCD ESD-20190228-end*/
static void push_table(struct LCM_setting_table *table, unsigned int count,
		       unsigned char force_update)
{
	unsigned int i;
    LCM_LOGI("nt35695----tps6132-lcm_init   push_table++++++++++++++===============================devin----\n");
	for (i = 0; i < count; i++) {
		unsigned cmd;

		cmd = table[i].cmd;

		switch (cmd) {

		case REGFLAG_DELAY:
			if (table[i].count <= 10)
				MDELAY(table[i].count);
			else
				MDELAY(table[i].count);
			break;

		case REGFLAG_END_OF_TABLE:
			break;

		default:
			dsi_set_cmdq_V2(cmd, table[i].count, table[i].para_list, force_update);
		}
	}
}




/* --------------------------------------------------------------------------- */
/* LCM Driver Implementations */
/* --------------------------------------------------------------------------- */

static void lcm_set_util_funcs(const struct LCM_UTIL_FUNCS *util)
{
	memcpy(&lcm_util, util, sizeof(struct LCM_UTIL_FUNCS));
}

static void lcm_get_params(struct LCM_PARAMS *params)
{
	memset(params, 0, sizeof(struct LCM_PARAMS));
	
	params->type = LCM_TYPE_DSI;
	
	params->width = FRAME_WIDTH;
	params->height = FRAME_HEIGHT;
	
	// enable tearing-free
	params->dbi.te_mode 				= LCM_DBI_TE_MODE_VSYNC_ONLY;
	params->dbi.te_edge_polarity		= LCM_POLARITY_RISING;
	#if (LCM_DSI_CMD_MODE)
	params->dsi.mode   = CMD_MODE;
	params->dsi.switch_mode = SYNC_PULSE_VDO_MODE;
	#else
	params->dsi.mode   = SYNC_PULSE_VDO_MODE;//SYNC_EVENT_VDO_MODE;//BURST_VDO_MODE;////
	#endif
		
	// DSI
	/* Command mode setting */
	//1 Three lane or Four lane
	params->dsi.LANE_NUM				= LCM_FOUR_LANE;
	//The following defined the fomat for data coming from LCD engine.
	params->dsi.data_format.color_order = LCM_COLOR_ORDER_RGB;
	params->dsi.data_format.trans_seq	= LCM_DSI_TRANS_SEQ_MSB_FIRST;
	params->dsi.data_format.padding 	= LCM_DSI_PADDING_ON_LSB;
	params->dsi.data_format.format		= LCM_DSI_FORMAT_RGB888;
		
		
	params->dsi.PS=LCM_PACKED_PS_24BIT_RGB888;
		
	#if (LCM_DSI_CMD_MODE)
	params->dsi.intermediat_buffer_num = 0;//because DSI/DPI HW design change, this parameters should be 0 when video mode in MT658X; or memory leakage
	params->dsi.word_count=FRAME_WIDTH*3;	//DSI CMD mode need set these two bellow params, different to 6577
	#else
	params->dsi.intermediat_buffer_num = 0; //because DSI/DPI HW design change, this parameters should be 0 when video mode in MT658X; or memory leakage
	#endif
	
	// Video mode setting
	params->dsi.packet_size=256;
	
	params->dsi.vertical_sync_active				=  4;
	params->dsi.vertical_backporch					= 60;//16 25 30 35 12 8
	params->dsi.vertical_frontporch					= 4;
	params->dsi.vertical_active_line				= FRAME_HEIGHT; 

	params->dsi.horizontal_sync_active = 8;
	params->dsi.horizontal_backporch = 10;//32
	params->dsi.horizontal_frontporch = 17;//78
	params->dsi.horizontal_active_pixel = FRAME_WIDTH;
	/* params->dsi.ssc_disable                                                       = 1; */

	params->dsi.PLL_CLOCK = 505;//520;//244;
	params->dsi.ssc_disable = 0;
	params->dsi.ssc_range = 1;
	params->dsi.cont_clock = 0;
	params->dsi.clk_lp_per_line_enable = 0;
	//prize-penggy modify LCD size-20190328-start
	params->physical_width = LCM_PHYSICAL_WIDTH/1000;
	params->physical_height = LCM_PHYSICAL_HEIGHT/1000;
	//prize-penggy modify LCD size-20190328-end
	params->physical_width_um = LCM_PHYSICAL_WIDTH;
	params->physical_height_um = LCM_PHYSICAL_HEIGHT;
	/*prize penggy add-for LCD ESD-20190219-start*/
	#if 1
	params->dsi.ssc_disable = 1;
	params->dsi.lcm_ext_te_monitor = FALSE;
		
	params->dsi.esd_check_enable = 1;
	params->dsi.customization_esd_check_enable = 1;
	params->dsi.lcm_esd_check_table[0].cmd					= 0x0a;
	params->dsi.lcm_esd_check_table[0].count			= 1;
	params->dsi.lcm_esd_check_table[0].para_list[0] = 0x1c;
	#endif
}



static unsigned int lcm_compare_id(void)
{
   return 0; 
}
#ifndef BUILD_LK
extern atomic_t ESDCheck_byCPU;
#endif
static unsigned int lcm_ata_check(unsigned char *bufferr)
{
//prize modify by wangfei for td4321 lcd ata 20210724 start
	unsigned int ret = 0;
	unsigned int id[4] = {0x02, 0x3C, 0xb0, 0x0A};
	unsigned int data_array[4];
	unsigned char read_buf[4];

	data_array[0] = 0x00043700; /* set max return size = 3 */
	dsi_set_cmdq(data_array, 1, 1);

	read_reg_v2(0xbf, read_buf, 4); /* read lcm id */

	LCM_LOGI("ATA read = 0x%x, 0x%x, 0x%x, 0x%x\n",
		 read_buf[0], read_buf[1], read_buf[2], read_buf[3]);

	if ((read_buf[0] == id[0]) &&
	    (read_buf[1] == id[1]) &&
	    (read_buf[2] == id[2]) &&
	    (read_buf[3] == id[3]))
		ret = 1;
	else
		ret = 0;

	return ret;
//prize modify by wangfei for td4321 lcd ata 20210724 end
}

static void lcm_init(void)
{
	
	display_bias_enable();
	MDELAY(10);

	SET_RESET_PIN(1);
	MDELAY(10);
	SET_RESET_PIN(0);
	MDELAY(10);  

	SET_RESET_PIN(1);
	MDELAY(60);//250
	
	push_table(lcm_initialization_setting,sizeof(lcm_initialization_setting) / sizeof(struct LCM_setting_table), 1);
}

static void lcm_suspend(void)
{
	push_table(lcm_suspend_setting,sizeof(lcm_suspend_setting) / sizeof(struct LCM_setting_table), 1);     
	display_bias_disable();
	MDELAY(10);//100
//prize add by wangfei for pull low reset when suspend 20210622 start
	SET_RESET_PIN(0);
	MDELAY(10);  
//prize add by wangfei for pull low reset when suspend 20210622 end
}

static void lcm_resume(void)
{
	lcm_init();
}

static void lcm_init_power(void)
{
	display_bias_enable();
}

static void lcm_suspend_power(void)
{
	display_bias_disable();
}

static void lcm_resume_power(void)
{
	SET_RESET_PIN(0); //prize-wyq 20190315 keep reset pin high to fix suspend current leakage
	display_bias_enable();
}

struct LCM_DRIVER td4321_fhdp_dsi_vdo_auo_drv = 
{
    .name			= "td4321_fhdp_dsi_vdo_auo",
	#if defined(CONFIG_PRIZE_HARDWARE_INFO) && !defined (BUILD_LK)
	.lcm_info = {
		.chip	= "td4321",
		.vendor	= "himax",
		.id		= "0x80",
		.more	= "1080*2340",
	},
	#endif
	.set_util_funcs = lcm_set_util_funcs,
	.get_params     = lcm_get_params,
	.init           = lcm_init,
	.suspend        = lcm_suspend,
	.init_power = lcm_init_power,
	.resume_power = lcm_resume_power,
	.suspend_power = lcm_suspend_power,
	.resume         = lcm_resume,
	.compare_id     = lcm_compare_id,
	.ata_check 		= lcm_ata_check,

};
